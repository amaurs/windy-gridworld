import Agent from './agent';
import {argMax, randomElement} from './util.js'

class QLearningAgent extends Agent {
    constructor(environment) {
        super(environment);
        //this.Q = [-1.6666650964129355,-1.6666646248948247,-1.6666646283276618,-1.66666485270934,-1.6666642295835286,-1.6666640718521941,-1.6666641980384436,-1.6666644484850022,-1.6666637783806089,-1.6666642320317435,-1.666662386043007,-1.666665038958484,-1.6666645468422052,-1.6666644860963855,-1.666664470926941,-1.6666578887613652,-1.6666623200519164,-1.6666620792537137,-1.666662900074235,-1.6666405452568085,-1.6666156535844836,-1.6666399980974351,-1.6666628228337081,-1.666601359698245,-1.66660023973801,-1.6666009402669104,-1.6666401473779633,-1.6665033992456124,-1.6665028577626855,-1.6665033947577061,-1.6666013241220643,-1.666258498114031,-1.6662532995645267,-1.6662490509239678,-1.6665032491225835,-1.665646245285077,-1.66075398340608,-1.6643017447152686,-1.6664975677942333,-1.6641156132126926,-1.6666653716259858,-1.6666654542147363,-1.6666653087405938,-1.6666653189942795,-1.6666651812067725,-1.6666648819689376,-1.666665208462238,-1.6666639323854147,-1.6666646328094277,-1.6666639389693603,-1.6666635156153164,-1.666663749592763,-1.6666611892493342,-1.666661559387347,-1.6666632690196017,-1.666656954996031,-1.6666520995486915,-1.666651740307013,-1.666649563981436,-1.6666405438788607,-1.6666014614555433,-1.6666294227968017,-1.6666423198526592,-1.666601359698245,-1.6666186919616255,-1.6666348236647681,-1.6665584625652188,-1.6665602568479585,-1.666494141022769,-1.6664698686783908,-1.6661137735503135,-1.6661517692074554,-1.665831054521908,-1.6658927475221208,-1.6664001028208393,-1.6656045711956613,-1.654274283718574,-1.6643052712550477,-1.6660238880948355,-1.6607719414157212,-1.6666657527053947,-1.6666656323832767,-1.6666657154582378,-1.6666656957235735,-1.6666655683410465,-1.6666650547800739,-1.6666655718077483,-1.6666649133353864,-1.6666634413935113,-1.6666648059662486,-1.666663945108464,-1.6666624742541443,-1.666661375201575,-1.6666603020997068,-1.6666633551173393,-1.6666562150689146,-1.6666529622666348,-1.6666556442812561,-1.6666538454981648,-1.6666405438792982,-1.6666358136840358,-1.6666343162575903,-1.6666357042226476,-1.6666237223377818,-1.6665375133593026,-1.666529010011938,-1.66653603454821,-1.6663967678286973,-1.6480082809420873,-1.653260115707099,-1.6319694689181328,-1.652915249718404,-1.6597996826751993,-1.6662679032981553,-1.6651038472712518,-1.6604202224573563,-1.6401656940527616,-1.6607563786857096,-1.651957299526899,-1.6546692515622925,-1.6666660547957604,-1.6666660618738487,-1.6666663290118855,-1.6666659979228944,-1.666665457262873,-1.6666658147935738,-1.666665677623442,-1.6666649948082108,-1.6666632952927387,-1.666663553994246,-1.666665757501195,-1.6666624870206823,-1.6666577418151445,-1.6666627491074062,-1.6666576085992015,-1.6666562175517192,-1.6666526480572779,-1.6666517082267427,-1.6666532300278938,-1.6666475349881966,-1.6666062874488878,-1.6666261310639645,-1.6666377572635345,-1.6665515528746961,-1.6661656442138246,-1.6665295516952985,-1.6665432811512322,-1.6662738199321399,0,0,0,0,-1.6577567119114243,-1.6517121670350219,-1.6523425594170285,-1.6553382987727623,-1.603214225604608,-1.651913221253577,-1.6580597804393844,-1.6269633224704,-1.6666657093492707,-1.6666652248176097,-1.6666656647367655,-1.6666653075372029,-1.6666637859402633,-1.6666645970498408,-1.6666653190682719,-1.6666644539775712,-1.666660439782519,-1.6666640352193165,-1.666665052767759,-1.6666615983753919,-1.6666586487272912,-1.6666617222845577,-1.6666610265304558,-1.6666554213017821,-1.6666190342904224,-1.6666179611548608,-1.6666287931077153,-1.6666196588107938,-1.6662253237414977,-1.6662407280209817,-1.6665117371597644,-1.6664628722372532,0,0,0,0,0,-1.3118896696192146,-0.8,0,2.7333264295097766,-1.6454273643031392,9.333333468395246,-1.6583391330967239,-1.50861889536,-1.536413556402882,2.7333333873581194,0.09277588687902766,-1.6666645998711154,-1.666665062269316,-1.6666644781557283,-1.6666629000664628,-1.6666607220015959,-1.666660926597318,-1.6666607503743815,-1.6666573404994272,-1.6666512362280461,-1.6666582638779537,-1.666659157486403,-1.6666521453074052,-1.6666464705391393,-1.6666512452738753,-1.6666602570245106,-1.6666439007742664,-1.666567571029894,-1.6666173627679695,-1.6666115987321848,-1.6665601664489933,0,0,0,0,0,0,0,0,0,0,0,0,-0.8,-0.8,-0.96,-0.9509726211263534,-1.3630976000000001,-1.3588344579073417,-1.3171199999999998,-1.4323200000000003,-1.6666625566104096,-1.666663695659136,-1.6666638269295675,-1.6666609991297594,-1.6666548464416566,-1.6666504371907855,-1.6666575822653493,-1.6666536425925882,-1.6666472165217125,-1.6666351284251177,-1.666651898554623,-1.666634965429389,-1.6665934646277571,-1.6666067340766517,-1.6666258719684999,-1.6665919736519306,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2.186666709886537,0,0,-0.99968,-1.2671999999999999,-0.8,-0.8];
        this.initEpisode();
    }
    /**
     * 
     * @returns {Object} information on the sate of the agent.
     */
    tick() {
        const state = this.environment.getState(this.position);
        const action = randomElement(this.epsilonGreedyPolicy(state, this.epsilon));
        const stepRes = this.environment.tick(this.position, action);
        const reward = stepRes.reward;
        const statePrime = this.environment.getState(stepRes.position);
        let qActionValues = [];
        for(let i=0; i < this.environment.getNumberOfActions(); i++) {
            qActionValues.push(this.Q[this.indexStateAction(statePrime, i)]);
        }
        const argMaxAction = randomElement(argMax(qActionValues));
        this.Q[this.indexStateAction(state, action)] = this.Q[this.indexStateAction(state, action)] + 
                                                       this.alpha * (reward + 
                                                                     this.gamma * this.Q[this.indexStateAction(statePrime, argMaxAction)] -
                                                                     this.Q[this.indexStateAction(state, action)]);
        this.position = stepRes.position;
        return {"isDone" : stepRes.isDone,
                "reward" : stepRes.reward};
    }
    /**
     * This will set the initial position of the agent by asking the
     * environment where to start.
     */
    initEpisode() {
        this.position = this.environment.initEnvironment();
    }
}

export { QLearningAgent as Agent };